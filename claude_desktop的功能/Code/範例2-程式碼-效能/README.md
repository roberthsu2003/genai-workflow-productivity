# 效能優化範例程式碼說明

這個資料夾包含一個有效能問題的 Python 專案，用於演示 Claude Code 的效能優化功能。

## 檔案說明

- `data_processor.py`: 資料處理模組，包含有效能瓶頸的 `main_processing()` 函式
- `test_performance.py`: 效能測試腳本，用來測試和比較效能

## 已知效能問題

這個專案有以下效能問題：

1. **N+1 查詢問題**：在迴圈中進行資料庫查詢，每筆記錄都查詢 2 次
   - 處理 10,000 筆資料 = 20,000 次資料庫查詢
   - 應該使用批次查詢或快取機制

2. **頻繁的檔案 I/O**：每次處理都開啟和關閉檔案
   - 應該使用批次寫入
   - 應該使用緩衝區

3. **沒有快取機制**：重複查詢相同的資料（例如相同的 user_id）
   - 應該快取已查詢的資料

4. **沒有批次處理**：一次只處理一筆記錄
   - 應該批次處理多筆記錄

## 如何使用

### 步驟 1：執行效能測試

```bash
cd 範例2-程式碼-效能
python test_performance.py
```

這會測試不同資料量的處理效能。

### 步驟 2：執行完整處理（較慢）

```bash
python data_processor.py
```

這會處理 1000 筆資料（完整測試用 10000 筆）。

### 步驟 3：使用 Claude Code 優化

使用 `範例2-程式碼重構與優化.md` 中的 Prompt 範例 2 來優化效能。

## 優化目標

使用 Claude Code 優化後，應該能夠：

- 減少資料庫查詢次數（使用批次查詢或快取）
- 減少檔案 I/O 操作（使用批次寫入）
- 將處理時間減少至少 50%
- 保持程式碼的可讀性
- 撰寫單元測試確保功能正確

## 預期改進

優化前（10,000 筆資料）：
- 處理時間：約 30 秒
- 資料庫查詢：20,000 次
- 檔案寫入：10,000 次

優化後（目標）：
- 處理時間：< 15 秒（減少 50% 以上）
- 資料庫查詢：大幅減少（使用批次查詢和快取）
- 檔案寫入：大幅減少（使用批次寫入）
