# 範例 2：程式碼重構與優化

## 目標

使用 Claude Code 重構和優化現有程式碼，提升可讀性、維護性和效能。

## 教學重點

- 學習程式碼重構的流程和方法
- 了解如何識別可以優化的程式碼模式
- 掌握程式碼品質改善的技巧

## 範例程式碼

在開始之前，請先下載範例程式碼到您的電腦：

### 範例 1：重構重複程式碼

**範例程式碼位置：** `./範例2-程式碼-重構/`

這個範例包含多個有重複程式碼的資料處理函式。

**使用方式：**
```bash
cd 範例2-程式碼-重構
python create_sample_data.py  # 建立測試資料
python main.py                 # 執行資料處理
```

---

## 操作步驟與 Prompt 對話範例

### Prompt 範例 1：重構重複程式碼

**請先將範例程式碼複製到您的專案位置，然後複製以下 prompt 貼到 Claude Code 對話框：**

```
我的 Python 專案中有很多重複的資料處理邏輯。

專案位置：[請指定您的專案路徑，例如：/Users/username/myproject/範例2-程式碼-重構]

問題：
我發現有多個函式都在做類似的事情：
- 讀取 CSV 檔案並驗證資料
- 將資料轉換成特定格式
- 寫入資料庫或檔案

請幫我：
1. 找出專案中所有重複或相似的程式碼片段
2. 分析這些重複程式碼的模式
3. 建立通用的函式來取代重複的程式碼
4. 重構所有使用這些重複程式碼的地方
5. 確保重構後的功能與原本相同
6. 加入註解說明重構的目的和使用方式

重構原則：
- 遵循 DRY（Don't Repeat Yourself）原則
- 保持函式的單一職責
- 確保程式碼的可讀性和可維護性
```

**使用情境說明：**
- 這個 prompt 展示了如何要求 AI 進行系統化的程式碼重構
- 強調識別重複模式和建立通用解決方案
- 讓學生學習如何提升程式碼的抽象層次

---

### 範例 2：效能優化

**範例程式碼位置：** `./範例2-程式碼-效能/`

這個範例包含一個有效能問題的資料處理函式。

**使用方式：**
```bash
cd 範例2-程式碼-效能
python test_performance.py  # 執行效能測試
python data_processor.py    # 執行資料處理（較慢）
```

---

### Prompt 範例 2：優化效能並加入測試

**請先將範例程式碼複製到您的專案位置，然後複製以下 prompt 貼到 Claude Code 對話框：**

```
我的專案中有一個處理大量資料的函式執行很慢。

專案位置：[請指定您的專案路徑，例如：/Users/username/myproject/範例2-程式碼-效能]

問題：
main_processing() 函式處理 10,000 筆資料需要花費約 30 秒。
我懷疑是因為在迴圈中進行了不必要的資料庫查詢或檔案讀寫。

請幫我：
1. 分析 main_processing() 函式的效能瓶頸
2. 找出可以優化的地方（例如：批次處理、快取、減少重複計算）
3. 重構程式碼以提升效能
4. 為重構後的程式碼撰寫單元測試
5. 確保優化後的程式碼功能與原本完全相同
6. 加入效能測試來驗證改進效果

優化目標：
- 將處理時間減少至少 50%
- 保持程式碼的可讀性
- 確保測試覆蓋率至少 80%
```

**使用情境說明：**
- 這個 prompt 展示了如何結合效能優化和測試撰寫
- 強調在優化時要確保功能的正確性
- 讓學生了解效能優化和程式碼品質的平衡

---

## 教學建議

### 課堂示範流程

1. **展示重構前的程式碼**
   - 先執行範例程式碼，讓學生看到重複程式碼或效能問題
   - 展示一個有重複程式碼或效能問題的專案
   - 討論為什麼需要重構
   - 說明重構的目標和原則

2. **執行重構過程**
   - 使用 Prompt 範例 1，讓學生觀察 AI 如何識別重複程式碼
   - 討論重構的步驟和決策過程
   - 比較重構前後的程式碼差異

3. **效能優化示範**
   - 使用 Prompt 範例 2，展示效能分析流程
   - 討論不同的優化策略
   - 強調測試的重要性

### 學習重點

✅ **重構技巧**：學習如何系統化地改善程式碼結構  
✅ **效能分析**：了解如何識別和解決效能瓶頸  
✅ **測試撰寫**：學習如何為重構後的程式碼撰寫測試  
✅ **程式碼品質**：理解可讀性、維護性和效能的平衡

---

> 💡 **提示**：學生可以根據自己的專案調整 prompt 中的路徑和問題描述，直接複製貼上使用。重構時記得使用 Git 版本控制，方便追蹤變更和回退。
