# 任務 7：自動化工作流程（老師範例）

> **本範例示範如何使用 AI 工具（Google Forms、Google Apps Script、ChatGPT/Claude API）建立自動化工作流程，將表單資料自動分析並產生報告**

---

## 📋 專案資訊

- **專案名稱**：客戶滿意度回饋自動分析系統
- **建立日期**：2025年1月15日
- **負責人**：王經理
- **建立者**：李工程師（使用 AI 工具協助）

### 專案目標
建立一個自動化流程，當客戶提交回饋表單後，系統自動：
1. 分析回饋內容的情感傾向（正面/負面/中性）
2. 提取關鍵意見和建議
3. 生成每週摘要報告
4. 自動發送報告給相關部門

---

## 🔧 系統架構

### 使用工具
- **Google Forms**：客戶回饋表單收集
- **Google Sheets**：資料儲存與整理
- **Google Apps Script**：自動化腳本執行
- **OpenAI ChatGPT API**：回饋內容分析
- **Gmail**：自動發送報告

### 流程架構圖

```
客戶填寫表單 → Google Forms 
    ↓
Google Sheets（儲存資料）
    ↓
Google Apps Script（觸發器）
    ↓
ChatGPT API（分析回饋）
    ↓
生成分析報告
    ↓
Gmail（自動發送給相關部門）
```

---

## 📝 實作過程

### 步驟一：設計表單

**表單內容設計：**

1. **客戶姓名**（簡答題）
   - 目的：識別客戶身份
   
2. **聯絡信箱**（簡答題，必填，驗證格式）
   - 目的：後續追蹤聯絡
   
3. **回饋類型**（單選題）
   - 產品使用體驗
   - 客戶服務品質
   - 功能建議
   - 問題回報
   - 其他
   
4. **滿意度評分**（單選題）
   - 非常滿意（5分）
   - 滿意（4分）
   - 普通（3分）
   - 不滿意（2分）
   - 非常不滿意（1分）
   
5. **回饋內容**（段落文字）
   - 目的：收集詳細意見

6. **提交時間**（自動記錄）

**Google Forms 設定：**
- 啟用「收集電子郵件地址」
- 啟用「回覆摘要」功能
- 將回應連結到 Google Sheets

---

### 步驟二：建立 Google Sheets 資料表

**表單回應 Sheet 結構：**

| 時間戳記 | 電子郵件 | 客戶姓名 | 回饋類型 | 滿意度評分 | 回饋內容 | AI分析結果 | 情感傾向 | 關鍵意見 |
|---------|---------|---------|---------|-----------|---------|-----------|---------|---------|
| 自動填入 | 自動填入 | 自動填入 | 自動填入 | 自動填入 | 自動填入 | （自動產生） | （自動產生） | （自動產生） |

**建立第二個 Sheet：分析報告摘要**
- 用於儲存每週自動產生的分析報告

---

### 步驟三：撰寫 Google Apps Script

**腳本功能說明：**

1. **onFormSubmit 函數**：當表單有新回應時觸發
   - 讀取新提交的回饋資料
   - 呼叫 ChatGPT API 分析回饋內容
   - 將分析結果寫回 Google Sheets

2. **analyzeFeedback 函數**：使用 ChatGPT API 分析回饋
   - 判斷情感傾向（正面/負面/中性）
   - 提取關鍵意見和建議
   - 回傳結構化的分析結果

3. **generateWeeklyReport 函數**：生成每週摘要報告
   - 統計本週的回饋數量
   - 分析整體滿意度趨勢
   - 整理關鍵意見和建議
   - 生成報告內容

4. **sendReportEmail 函數**：發送報告郵件
   - 將報告以郵件形式發送給相關部門
   - 根據回饋類型分發給不同部門

**關鍵程式碼範例：**

```javascript
// 當表單有新回應時觸發
function onFormSubmit(e) {
  var sheet = e.source.getActiveSheet();
  var row = e.range.getRow();
  
  // 讀取新提交的資料
  var feedback = sheet.getRange(row, 6).getValue(); // 回饋內容欄位
  var feedbackType = sheet.getRange(row, 4).getValue(); // 回饋類型
  
  // 使用 ChatGPT API 分析
  var analysis = analyzeFeedbackWithAI(feedback);
  
  // 寫回分析結果
  sheet.getRange(row, 7).setValue(analysis.summary);
  sheet.getRange(row, 8).setValue(analysis.sentiment);
  sheet.getRange(row, 9).setValue(analysis.keyPoints);
}

// 使用 ChatGPT API 分析回饋
function analyzeFeedbackWithAI(feedback) {
  var apiKey = 'YOUR_OPENAI_API_KEY';
  var url = 'https://api.openai.com/v1/chat/completions';
  
  var prompt = `請分析以下客戶回饋：
  
  ${feedback}
  
  請提供：
  1. 情感傾向（正面/負面/中性）
  2. 關鍵意見摘要（3-5 點）
  3. 具體建議（如有）
  
  請以 JSON 格式回傳：
  {
    "sentiment": "正面/負面/中性",
    "keyPoints": ["重點1", "重點2", "重點3"],
    "suggestions": ["建議1", "建議2"],
    "summary": "整體摘要"
  }`;
  
  var payload = {
    "model": "gpt-3.5-turbo",
    "messages": [
      {"role": "user", "content": prompt}
    ],
    "temperature": 0.7
  };
  
  var options = {
    'method': 'post',
    'contentType': 'application/json',
    'headers': {
      'Authorization': 'Bearer ' + apiKey
    },
    'payload': JSON.stringify(payload)
  };
  
  var response = UrlFetchApp.fetch(url, options);
  var responseText = response.getContentText();
  var jsonResponse = JSON.parse(responseText);
  
  var aiResult = jsonResponse.choices[0].message.content;
  
  // 解析 AI 回傳的 JSON
  var analysis = JSON.parse(aiResult);
  
  return analysis;
}

// 每週生成報告（設定時間觸發器）
function generateWeeklyReport() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('表單回應 1');
  var data = sheet.getDataRange().getValues();
  
  // 計算本週的統計資料
  var thisWeekData = getThisWeekData(data);
  var totalCount = thisWeekData.length;
  var avgSatisfaction = calculateAvgSatisfaction(thisWeekData);
  var sentimentDistribution = calculateSentimentDistribution(thisWeekData);
  
  // 生成報告內容
  var report = generateReportContent(thisWeekData, totalCount, avgSatisfaction, sentimentDistribution);
  
  // 儲存報告到 Sheet
  var reportSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('分析報告摘要');
  reportSheet.appendRow([new Date(), report]);
  
  // 發送郵件
  sendReportEmail(report);
}
```

---

### 步驟四：設定 API 金鑰

**OpenAI API 設定：**
1. 前往 OpenAI 官網註冊帳號
2. 申請 API 金鑰
3. 在 Google Apps Script 中設定環境變數儲存 API 金鑰
4. 設定 API 使用額度限制（避免超支）

**安全注意事項：**
- 不要將 API 金鑰直接寫在程式碼中
- 使用環境變數或 Google Apps Script 的 PropertiesService
- 限制 API 呼叫頻率，避免過度使用

---

### 步驟五：設定觸發器

**觸發器設定：**

1. **表單提交觸發器**
   - 類型：可安裝觸發器
   - 事件：表單提交
   - 函數：onFormSubmit
   - 執行時機：每次有新表單回應時自動執行

2. **每週報告觸發器**
   - 類型：時間驅動
   - 頻率：每週
   - 執行時間：每週一早上 9:00
   - 函數：generateWeeklyReport

**設定方式：**
1. 在 Google Apps Script 編輯器中
2. 點選「觸發條件」→「新增觸發條件」
3. 選擇觸發器類型和設定

---

### 步驟六：測試與優化

**測試流程：**

1. **測試表單提交**
   - 提交測試回饋表單
   - 確認資料正確寫入 Google Sheets
   - 確認 AI 分析功能正常運作

2. **測試 AI 分析**
   - 提交正面回饋，確認情感傾向正確
   - 提交負面回饋，確認能提取關鍵問題
   - 確認分析結果格式正確

3. **測試報告生成**
   - 手動執行 generateWeeklyReport 函數
   - 確認報告內容完整
   - 確認郵件發送成功

4. **效能優化**
   - 監控 API 呼叫次數和費用
   - 優化提示詞（Prompt）以提高分析準確度
   - 調整觸發器頻率避免過度執行

---

## 📊 實際執行結果範例

### 表單回應範例

| 時間戳記 | 客戶姓名 | 回饋類型 | 滿意度 | 回饋內容 |
|---------|---------|---------|--------|---------|
| 2025/1/15 14:30 | 張先生 | 產品使用體驗 | 4 | 產品功能很好用，但希望可以增加更多客製化選項 |
| 2025/1/15 15:20 | 李小姐 | 問題回報 | 2 | 使用過程中遇到登入問題，希望能盡快解決 |
| 2025/1/16 10:15 | 王先生 | 功能建議 | 5 | 建議新增行動裝置版本，會更方便使用 |

### AI 分析結果範例

**張先生的回饋分析：**
- **情感傾向**：正面
- **關鍵意見**：
  1. 產品功能獲得肯定
  2. 希望增加客製化選項
  3. 整體滿意度良好
- **建議**：考慮開發更多客製化功能
- **摘要**：客戶對產品功能滿意，主要需求是增加客製化選項

**李小姐的回饋分析：**
- **情感傾向**：負面
- **關鍵意見**：
  1. 遇到登入技術問題
  2. 需要立即處理
  3. 影響使用體驗
- **建議**：優先處理登入問題，聯繫客戶協助解決
- **摘要**：客戶遇到技術問題，需要技術支援部門立即處理

### 每週報告範例

**2025年1月第2週客戶回饋分析報告**

**統計摘要：**
- 本週總回饋數：15 筆
- 平均滿意度：3.8 分（5分滿分）
- 情感分布：正面 60%（9筆）、中性 27%（4筆）、負面 13%（2筆）

**關鍵發現：**
1. **產品功能獲得肯定**：多數客戶對產品功能表示滿意
2. **客製化需求增加**：3 位客戶提出客製化選項需求
3. **技術問題需關注**：有 2 位客戶回報技術問題，需優先處理

**部門分發建議：**
- **產品部門**：收到 5 筆功能建議，重點關注客製化需求
- **技術支援部門**：收到 2 筆問題回報，需立即處理登入問題
- **客服部門**：收到 8 筆使用體驗回饋，整體正面

**行動項目：**
1. 技術部門：本週內解決登入問題
2. 產品部門：評估客製化功能的可行性
3. 客服部門：聯繫負面回饋客戶，了解詳細情況

---

## 🤖 AI 工具使用說明

### 使用的 AI 工具

1. **ChatGPT API**
   - **功能**：自然語言處理，分析回饋內容
   - **使用方式**：透過 Google Apps Script 呼叫 API
   - **優點**：準確度高，能理解語意和情感
   - **限制**：需要付費 API，有使用額度限制

2. **Google Apps Script**
   - **功能**：自動化腳本執行
   - **使用方式**：撰寫 JavaScript 程式碼，設定觸發器
   - **優點**：與 Google 服務完美整合，免費使用
   - **限制**：執行時間和 API 呼叫次數有限制

### AI 提示詞（Prompt）範例

**基本分析提示詞：**
```
請分析以下客戶回饋：

{回饋內容}

請提供：
1. 情感傾向（正面/負面/中性）
2. 關鍵意見摘要（3-5 點）
3. 具體建議（如有）

請以 JSON 格式回傳。
```

**進階分析提示詞：**
```
你是客戶體驗分析專家。請分析以下客戶回饋：

客戶回饋：
{回饋內容}

回饋類型：{回饋類型}
滿意度評分：{評分}

請提供詳細分析：
1. 情感傾向（正面/負面/中性）及信心度
2. 關鍵問題或亮點（列出 3-5 點）
3. 具體改善建議
4. 優先處理等級（高/中/低）

請以結構化的 JSON 格式回傳，方便程式處理。
```

### 使用流程

1. **設計表單**：根據需求設計 Google Forms 表單
2. **撰寫腳本**：在 Google Apps Script 中撰寫自動化腳本
3. **整合 API**：設定 ChatGPT API 金鑰並整合
4. **設定觸發器**：設定表單提交和時間觸發器
5. **測試運行**：提交測試資料確認功能正常
6. **監控優化**：定期檢查執行結果，優化分析邏輯

---

## ⚠️ 注意事項與最佳實踐

### 成本控制

1. **API 使用額度**
   - 設定 API 使用上限，避免超支
   - 考慮使用 gpt-3.5-turbo 而非 gpt-4（成本較低）
   - 優化提示詞，減少 token 使用量

2. **免費方案替代**
   - 如果預算有限，可以改為半自動化
   - 手動批次處理回饋資料，使用 ChatGPT 網頁版分析
   - 每週手動執行一次分析，而非即時分析

### 資料隱私

1. **客戶資料保護**
   - 確保 API 不會洩露客戶資訊
   - 遵守資料保護法規（如 GDPR）
   - 妥善保管 API 金鑰

2. **資料儲存**
   - 敏感資訊加密儲存
   - 定期備份資料
   - 設定適當的存取權限

### 錯誤處理

1. **API 錯誤處理**
   - 處理 API 呼叫失敗的情況
   - 設定重試機制
   - 記錄錯誤日誌

2. **資料驗證**
   - 驗證表單輸入格式
   - 檢查 API 回傳資料格式
   - 處理異常資料

---

## 📝 備註

- 本範例使用 OpenAI ChatGPT API，也可以改用 Claude API 或 Google Gemini API
- 如需完全自動化，建議使用付費 API 方案
- 免費方案可以改為「半自動」：定期手動執行分析，仍能大幅減少工作量
- 定期檢視和優化自動化流程，確保準確性和效率

---

*本文件使用 Markdown 格式撰寫，可直接作為教學範例使用*
